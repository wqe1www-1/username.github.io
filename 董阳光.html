<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />

 <!-- 引入 layui.css -->
 <link rel="stylesheet" href="https://unpkg.com/layui@2.7.6/dist/css/layui.css">
 
 <!-- 引入 layui.js -->
 <script src="https://unpkg.com/layui@2.7.6/dist/layui.js">
  </script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>

    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  </head>

  <style>
    #box {
      width: 185px;
      height: 300px;
      position: absolute;
      left: 50%;
      top: 400px;
      transform: translate(-50%, -50%);
      background: rgb(209, 47, 47, 0.5);
      display: none;
    }
    #ome {
      width: 200px;
      height: 400px;
      position: absolute;
      left: 7%;
      top: 500px;
      transform: translate(-50%, -50%);
      background: rgba(250, 245, 245, 0.9);
      display: none;
    }
    #div2 {
      display: none;
    }

    * {
      margin: 0;
      padding: 0;
    }
    #detail_One {
      width: 400px;
      height: 400px;
      position: absolute;
      left: 50%;
      top: 400px;
      transform: translate(-50%, -50%);
      background: rgba(250, 245, 245, 0.9);
      display: none;
    }
    body {
      width: 100%;
      padding: 10px;
    }

    .box {
      width: 100%;
 
      padding: 20px;
      float: left;
    }

    .ins {
      background: #fff;
      box-shadow: 0 0 10px rgb(0, 0, 0);
      border-radius: 10px;
      padding: 20px;
      z-index: 999;
      opacity: 1;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      display: none;
    }

    #imgo {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-left: 30px;
      margin-top: 10px;
      margin-bottom: 10px;
    }
  </style>
  <body>
    <div class="layui-layout layui-layout-admin">
      <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">layout demo</div>
        <!-- 添加 -->
        <div id="box">
          <div class="layui-input-inline">
            <input
              type="text"
              name="password"
              required
              lay-verify="required"
              placeholder="姓名"
              autocomplete="off"
              class="layui-input"
              id="Name_one"
            />
          </div>
          <br />
          <br />
          <div class="layui-input-inline">
            <input
              type="text"
              name="password"
              required
              lay-verify="required"
              placeholder="密码"
              autocomplete="off"
              class="layui-input"
              id="password"
            />
          </div>
          <br />
          <br />
          <div class="layui-input-inline">
            <input
              type="text"
              name="password"
              required
              lay-verify="required"
              placeholder="验证码"
              autocomplete="off"
              class="layui-input"
              id="Verification"
            />
            <span><img src="" alt="" id="code" width="70%" /></span>
          </div>
          <br /><br />
          <button class="layui-btn layui-btn-radius" id="Add_two">添加</button>
          <button class="layui-btn layui-btn-radius" id="Shut_down">
            关闭
          </button>
        </div>

        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
          <!-- 移动端显示 -->
          <li
            class="layui-nav-item layui-show-xs-inline-block layui-hide-sm"
            lay-header-event="menuLeft"
          >
            <i class="layui-icon layui-icon-spread-left"></i>
          </li>
          <li class="layui-nav-item layui-hide-xs"><a href="">nav 1</a></li>
          <li class="layui-nav-item layui-hide-xs"><a href="">nav 2</a></li>
          <li class="layui-nav-item layui-hide-xs"><a href="">nav 3</a></li>
          <li class="layui-nav-item">
            <a href="#">nav groups</a>
            <dl class="layui-nav-child">
              <dd><a href="">menu 11</a></dd>
              <dd><a href="">menu 22</a></dd>
              <dd><a href="">menu 33</a></dd>
            </dl>
          </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
          <li class="layui-nav-item layui-hide layui-show-md-inline-block">
            <a href="#"> 变色 </a>
            <dl class="layui-nav-child">
              <dd id="annu"><a href="#">黑色</a></dd>
              <dd id="annu1"><a href="#">白色</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
            <a href="#">
              <i class="layui-icon layui-icon-more-vertical"></i>
            </a>
          </li>
        </ul>
      </div>
      <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
          <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
          <div class="layui-anim" data-anim="layui-anim-rotate layui-anim-loop">
            <img
              id="imgo"
              class="layui-anim layui-anim-rotate"
              data-anim="layui-anim-rotate"
              src="https://img0.baidu.com/it/u=3425868493,3104015061&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1682182800&t=00614eaa41389bb829bc718ad6621412"
              alt=""
            />
          </div>
          <ul class="layui-nav layui-nav-tree" lay-filter="test">
            <li class="layui-nav-item layui-nav-itemed">
              <a class="sou" href="#">歌曲</a>
            </li>
            <li class="layui-nav-item">
              <a href="#" class="lie">Vjas</a>
            </li>
            <li class="layui-nav-item"><a class="le" href="#">仪表盘</a></li>
            <li class="layui-nav-item"><a href="#">the links</a></li>
          </ul>
        </div>
      </div>
      <div class="layui-body">
        <!-- 内容主体区域 -->
        <div id="div1" style="margin-left: 5%; margin-top: 5%">
          <div class="box">
            <!-- 添加 -->
            <button
              type="button"
              class="layui-btn"
              onclick="Increase()"
              style="float: left; margin-right: 50px"
            >
              <i class="layui-icon"></i>
            </button>
            <div class="layui-form">
              <table class="layui-table">
                <thead>
                  <tr>
                    <th>id</th>
                    <th>歌曲名称</th>
                    <th>艺术家</th>
                    <th>专辑名称</th>
                    <th>年代</th>
                    <th>类型</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="list"></tbody>
              </table>
              <!-- 分页 -->
              <button
                onclick="pagination(1)"
                type="button"
                class="layui-btn layui-btn-primary layui-btn-sm"
              >
                <i class="layui-icon"></i>
              </button>

              <span id="fy">1</span>

              <button
                onclick="pagination(2)"
                type="button"
                class="layui-btn layui-btn-primary layui-btn-sm"
              >
                <i class="layui-icon"></i>
              </button>
            </div>
          </div>

          <!-- 编辑和添加 -->
          <div class="ins" id="koplll">
            <div class="layui-form-item">
              <label class="layui-form-label">歌曲名称</label>
              <div class="layui-input-block" style="width: 300px">
                <input
                  id="goods_name"
                  type="text"
                  name="title"
                  lay-verify="title"
                  autocomplete="off"
                  placeholder="请输入"
                  class="layui-input"
                />
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">艺术家</label>
              <div class="layui-input-block" style="width: 300px">
                <input
                  id="sold"
                  type="text"
                  name="title"
                  lay-verify="title"
                  autocomplete="off"
                  placeholder="请输入"
                  class="layui-input"
                />
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">专辑名称</label>
              <div class="layui-input-block" style="width: 300px">
                <input
                  id="soldpp"
                  type="text"
                  name="title"
                  lay-verify="title"
                  autocomplete="off"
                  placeholder="请输入"
                  class="layui-input"
                />
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">年代</label>
              <div class="layui-input-block" style="width: 300px">
                <input
                  id="sd"
                  type="text"
                  name="title"
                  lay-verify="title"
                  autocomplete="off"
                  placeholder="请输入"
                  class="layui-input"
                />
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">类型</label>
              <div class="layui-input-block" style="width: 300px">
                <input
                  id="sdgwe"
                  type="text"
                  name="title"
                  lay-verify="title"
                  autocomplete="off"
                  placeholder="请输入"
                  class="layui-input"
                />
              </div>
            </div>
            <button
              type="button"
              class="layui-btn"
              id="an"
              onclick="qr()"
            ></button>
            <button
              type="button"
              class="layui-btn layui-btn-normal"
              onclick="qx()"
            >
              取消
            </button>
          </div>

          <!-- 弹出框 -->
          <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
            <div
              id="liveToast"
              class="toast"
              role="alert"
              aria-live="assertive"
              aria-atomic="true"
            >
              <div class="toast-header">
                <small id="sma"></small>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="toast"
                  aria-label="Close"
                ></button>
              </div>
              <div class="toast-body" id="toast"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      layui.use(["element", "layer", "util"], function () {
        var element = layui.element,
          layer = layui.layer,
          util = layui.util,
          $ = layui.$;
      });
      $(function () {
        list();
        if (localStorage.getItem("saveData") != null) {
          $("#goods_name").val(
            JSON.parse(localStorage.getItem("saveData"))[0].title
          );
          $("#sold").val(
            JSON.parse(localStorage.getItem("saveData"))[0].artist
          );
          $("#soldpp").val(
            JSON.parse(localStorage.getItem("saveData"))[0].album
          );
          $("#sd").val(JSON.parse(localStorage.getItem("saveData"))[0].year);
          $("#sdgwe").val(
            JSON.parse(localStorage.getItem("saveData"))[0].genre
          );
        }
        $("#koplll input").change(function () {
          let saveData = [
            {
              title: $("#goods_name").val(),
              artist: $("#sold").val(),
              album: $("#soldpp").val(),
              year: $("#sd").val(),
              genre: $("#sdgwe").val(),
            },
          ];
          localStorage.setItem("saveData", JSON.stringify(saveData));
        });
        if (JSON.parse(localStorage.getItem("nh")) == "白色") {
          $("body").css("background", "#fff");
        } else {
          $("body").css("background", "#000");
        }
        $("#annu").on("click", function () {
          localStorage.setItem("nh", JSON.stringify($(this).children().text()));
          $("body").css("background", "#000");
        });
        $("#annu1").on("click", function () {
          localStorage.setItem("nh", JSON.stringify($(this).children().text()));
          $("body").css("background", "#fff");
        });
      });
      function qrs(urls, types, obj) {
        $.ajax({
          url: urls,
          type: types,
          data: obj,
          dataType: "json",
          headers: {
            "Content-Type": "application/json",
          },
          success: function (res) {
            $("#toast").text(res.msg);
            new bootstrap.Toast($("#liveToast")[0]).show();
            $(".ins").hide();
            list();
          },
        });
      }
      var xuoao = 0;

      function qr() {
        if ($("#an").text() == "修改") {
          //修改传的参数
          var obj = {
            id: xuoao,
            title: $("#goods_name").val(),
            artist: $("#sold").val(),
            album: $("#soldpp").val(),
            year: $("#sd").val(),
            genre: $("#sdgwe").val(),
          };

          //修改
          qrs(
            "http://81.68.107.245/api/songs/" + xuoao,
            "PUT",
            JSON.stringify(obj)
          );
        } else if ($("#an").text() == "添加") {
          //添加传的参数
          let obj = {
            title: $("#goods_name").val(),
            artist: $("#sold").val(),
            album: $("#soldpp").val(),
            year: $("#sd").val(),
            genre: $("#sdgwe").val(),
          };
          //添加
          qrs("http://81.68.107.245/api/songs", "POST", JSON.stringify(obj));
        }
      }

      //隐藏
      function qx() {
        $(".ins").hide();
      }
      // 添加显示
      function Increase() {
        var h = $(window).height();
        var w = $(window).width();
        $("#an").text("添加");
        $(".ins").css({
          display: "block",
          width: w * 0.3,
          height: h * 0.6,
        });
      }
      function rty(id) {
        xuoao = id;
        //获得窗口的高度和宽度
        var h = $(window).height();
        var w = $(window).width();
        $("#an").text("修改");
        $(".ins").css({
          display: "block",
          width: w * 0.3,
          height: h * 0.6,
        });
        //用户详细
        $.ajax({
          url: `http://81.68.107.245/api/songs/` + id,
          type: "GET",
          dataType: "json",
          success: function (res) {
            $("#goods_name").val(res.data.title);
            $("#sold").val(res.data.artist);
            $("#soldpp").val(res.data.album);
            $("#sd").val(res.data.year);
            $("#sdgwe").val(res.data.genre);
          },
        });
      }

      function detailed(id) {
        $.ajax({
          url: `http://81.68.107.245/api/songs/` + id,
          type: "GET",
          dataType: "json",
          success: function (res) {
            let html = `
                <table class="layui-table">
                <tbody>
                <tr>
                <td>歌曲名称:</td>
                <td>${res.data.title}</td>
                </tr>
                <td>艺术家:</td>
                <td>${res.data.artist}</td>
                </tr>
                <tr>
                <td>专辑名称:</td>
                <td>${res.data.album}</td>
                </tr>
                <tr>
                <td>年代:</td>
                <td>${res.data.year}</td>
                </tr>
                <tr>
                <td>类型:</td>
                <td>${res.data.genre}</td>
                </tbody>
                </table>
                `;
            layer.msg(html);
          },
        });
      }
      //删除用户
      function del(id) {
        $.ajax({
          url: `http://81.68.107.245/api/songs/` + id,
          type: "DELETE",
          dataType: "json",
          success: function (res) {
            if (confirm('确定删除吗')) {
            $("#toast").text("删除成功");
            new bootstrap.Toast($("#liveToast")[0]).show();
            list();
          }
        },
        });
      }

      var obj = 1;
      let pageAll;
      //用户列表
      function list() {
        $.ajax({
          type: "get",
          url: "http://81.68.107.245/api/songs?page=" + obj + "&pageSize=" + 10,
          dataType: "json",
          success: function (res) {
            $("#fy").text(obj);
            fun(res.data);
            pageAll = Math.ceil(res.count / res.pageSize);
            localStorage.setItem("minggzi", JSON.stringify(res.data));
          },
        });
      }
      //分页
      function pagination(index) {
        if (index == 2) {
          if (obj == pageAll) {
            obj = pageAll;
            alert("最后一页了");
            return;
          } else {
            obj++;
          }
        } else {
          if (obj == 1) {
            return;
          }
          obj--;
        }
        list(obj);
      }
      //渲染数据
      function fun(res) {
        var html = "";
        res.map((item, index) => {
          html += `<tr>
                    <td>${item.id}</td>
                    <td>${item.title}</td>
                    <td>${item.artist}</td>
                    <td>${item.album}</td>
                    <td>${item.year}</td>
                    <td>${item.genre}</td>
                    <td> 
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" onclick='rty(${item.id})'><i class="layui-icon"></i></button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" onclick='del(${item.id})'><i class="layui-icon"></i></button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" onclick='detailed(${item.id})'><i class="layui-icon"></i></button>
                    </td>
                    </tr>`;
        });
        $("#list").html(html);
      }
    </script>
  </body>
</html>
